---
title: "18-ortholog-lists"
output: html_document
date: "2025-04-09"
---

```{r}
# Required packages
library(httr)
library(jsonlite)
library(dplyr)
library(stringr)
library(purrr)
library(RCurl)
```


```{r cars}


# Replace this with your actual vector of UniProt IDs
top_genes <- read.csv("/home/shared/8TB_HDD_02/graceleuchtenberger/Github/byssus-exp-analysis/output/Top_gene_summaries/Top_50_genes/GOW_topgenes.csv")

uniprot_ids <- c(top_genes$uniprot_accession)   

# Step 1: Get the list of Mollusca species from OrthoDB
species_url <- "https://data.orthodb.org/current/download/odb12v1_species.tab.gz"
dest_file <- "/home/shared/8TB_HDD_02/graceleuchtenberger/Github/byssus-exp-analysis/output/Top_gene_summaries/ortho_species.tab.gz"

# Download the file
download.file(species_url, destfile = dest_file, mode = "wb")

# Read the gzipped tab-delimited file
species_df <- read.delim(gzfile(dest_file), header = FALSE, sep = "\t")
species_df <- species_df[, 1:4]

# Filter for Mollusca species
mollusca_species <- c(6500, 370345, 6526, 112525,55810, 100452, 6565, 29159, 558553, 45954,188477,1093978, 80821, 2589376, 703304, 1735272, 6454,36100,356393, 225164, 6596, 6573, 6604,6549,6550, 29158, 42192, 37653, 2607531, 37623, 6465, 87960, 88005, 6579, 109671, 259542, 400727, 158019, 31201, 220873, 80829, 80833)
mollusca_species <- as.integer(mollusca_species)
mollusca_species <- as.data.frame(mollusca_species)
colnames(mollusca_species) <- c("orthodb_id")

mollusca_taxids <- left_join(mollusca_species, species_df, by = "orthodb_id")

bivalve_species <- c(6565, 29159, 558553, 45954, 80821, 2589376, 356393, 6596, 6573, 6604,6549,6550, 29158, 42192, 37623, 6579, 31201, 220873, 80829, 80833)
bivalve_species <- as.integer(bivalve_species)
bivalve_species <- as.data.frame(bivalve_species)
colnames(bivalve_species) <- c("orthodb_id")

bivalve_taxids <- left_join(bivalve_species, mollusca_taxids, by = "orthodb_id")

```


```{r}
get_orthologs_for_uniprot <- function(topgene_summs, bivalve_taxids){
  uniprot_ids <- topgene_summs$UniProt_ID
  for (i in 1:length(uniprot_ids)){
  test_result <- entrez_search(db="gene", term= uniprot_ids[i], retmax=1, api_key="8f817031916b3cfee7ec443b712c426d9a08")
  gene <- test_result$ids
  # Step 1: Find ortholog group for UniProt ID
  gene_URL <- paste0("https://data.orthodb.org/v12/search?query=", gene,"&take=10000&level=33208")
  ortho_group <- GET(gene_URL)
  ortho_json <- content(ortho_group, as = "text", encoding = "UTF-8")
  ortho <- fromJSON(result_json, flatten = TRUE)
  groupID <- ortho$data
  group_url <- paste0("https://data.orthodb.org/v12/orthologs?id=", groupID)
  group_response <- GET(group_url)
  group_json <- content(group_response, as = "text", encoding = "UTF-8")
  group_data <- fromJSON(group_json, flatten = TRUE)
  group_data <- as.data.frame(group_data)
  
  mollusc_list <- bivalve_taxids[bivalve_taxids$orthodb_key %in% group_data$data.organism.id, c("orthodb_key", "species_name")]
  mollusc_listicle <- as.list(mollusc_list$species_name)
  topgene_summs$bivalve_validation[i] <- paste(mollusc_listicle, collapse = ", ")
  }
  return(topgene_summs)
}

  
  
```

```{r}
GOW_topgene_summs_biv <- get_orthologs_for_uniprot(GOW_topgene_summs, bivalve_taxids)
```

